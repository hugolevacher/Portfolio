<div class="portal-status-container">
    <div class="status-box">
        <strong>API Status</strong><br>
        <span *ngIf="apiStatus">{{ apiStatus.status }}<br>
            <small *ngIf="apiStatus.timestamp">{{ apiStatus.timestamp }}</small>
            <span *ngIf="apiStatus.error" style="color:red;">{{ apiStatus.error }}</span>
        </span>
        <span *ngIf="!apiStatus">Loading...</span>
    </div>
    <div class="status-box">
        <strong>DB Status</strong><br>
        <span *ngIf="dbStatus">{{ dbStatus.status }}<br>
            <small *ngIf="dbStatus.timestamp">{{ dbStatus.timestamp }}</small>
            <span *ngIf="dbStatus.error" style="color:red;">{{ dbStatus.error }}</span>
        </span>
        <span *ngIf="!dbStatus">Loading...</span>
    </div>
</div>

<div class="portal-login-section">
    <form *ngIf="!loginSuccess" (ngSubmit)="login()" #loginForm="ngForm" class="login-form">
        <input name="username" [(ngModel)]="username" type="text" placeholder="Username" required>
        <input name="password" [(ngModel)]="password" type="password" placeholder="Password" required>
        <button type="submit">Login</button>
        <div *ngIf="loginError" class="error-message">{{ loginError }}</div>
    </form>
    <div *ngIf="loginSuccess" class="welcome-form">
        <span>Welcome, {{ userData?.user?.username }}</span>
        <button type="button" (click)="logout()">Logout</button>
    </div>
</div>

<!-- Skills Management Section -->
<div class="management-section">
    <div class="section-header">
        <h2>Skills Management</h2>
        <button *ngIf="isLoggedIn" class="btn-create" (click)="openCreateSkill()">Create Skill</button>
    </div>

    <div *ngIf="skillsLoading" class="loading">Loading skills...</div>
    <div *ngIf="skillsError" class="error-message">{{ skillsError }}</div>

    <div *ngIf="!skillsLoading && !skillsError" class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Order</th>
                    <th>Image</th>
                    <th *ngIf="isLoggedIn">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let skill of skills" class="data-row">
                    <td>{{ skill.id }}</td>
                    <td>{{ skill.name }}</td>
                    <td>{{ skill.order }}</td>
                    <td>
                        <img *ngIf="skill.filename" [src]="api.getImageUrl(skill.filename)" [alt]="skill.name"
                            class="preview-image">
                        <span *ngIf="!skill.filename">No image</span>
                    </td>
                    <td *ngIf="isLoggedIn" class="actions">
                        <button class="btn-edit" (click)="openEditSkill(skill)">Edit</button>
                        <button class="btn-delete" (click)="openDeleteSkill(skill)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="skills.length === 0" class="no-data">
            No skills found.
        </div>
    </div>
</div>

<!-- Projects Management Section -->
<div class="management-section">
    <div class="section-header">
        <h2>Projects Management</h2>
        <button *ngIf="isLoggedIn" class="btn-create" (click)="openCreateProject()">Create Project</button>
    </div>

    <div *ngIf="projectsLoading" class="loading">Loading projects...</div>
    <div *ngIf="projectsError" class="error-message">{{ projectsError }}</div>

    <div *ngIf="!projectsLoading && !projectsError" class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Order</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th *ngIf="isLoggedIn">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let project of projects" class="data-row">
                    <td>{{ project.id }}</td>
                    <td>{{ project.order }}</td>
                    <td>{{ project.title }}</td>
                    <td class="description-cell">{{ project.description }}</td>
                    <td>
                        <img *ngIf="project.image" [src]="api.getImageUrl(project.image)" [alt]="project.title"
                            class="preview-image">
                        <span *ngIf="!project.image">No image</span>
                    </td>
                    <td *ngIf="isLoggedIn" class="actions">
                        <button class="btn-edit" (click)="openEditProject(project)">Edit</button>
                        <button class="btn-delete" (click)="openDeleteProject(project)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="projects.length === 0" class="no-data">
            No projects found.
        </div>
    </div>
</div>

<!-- Skills Popups -->
<app-skill-create *ngIf="showSkillCreate" (close)="onSkillPopupClosed()" (skillCreated)="onSkillCreated()">
</app-skill-create>

<app-skill-edit *ngIf="showSkillEdit && selectedSkill" [skill]="selectedSkill" (close)="onSkillPopupClosed()"
    (skillUpdated)="onSkillUpdated()">
</app-skill-edit>

<app-skill-delete *ngIf="showSkillDelete && selectedSkill" [skill]="selectedSkill" (close)="onSkillPopupClosed()"
    (skillDeleted)="onSkillDeleted()">
</app-skill-delete>

<!-- Projects Popups -->
<app-project-create *ngIf="showProjectCreate" (close)="onProjectPopupClosed()" (projectCreated)="onProjectCreated()">
</app-project-create>

<app-project-edit *ngIf="showProjectEdit && selectedProject" [project]="selectedProject"
    (close)="onProjectPopupClosed()" (projectUpdated)="onProjectUpdated()">
</app-project-edit>

<app-project-delete *ngIf="showProjectDelete && selectedProject" [project]="selectedProject"
    (close)="onProjectPopupClosed()" (projectDeleted)="onProjectDeleted()">
</app-project-delete>