<div class="portal-status-container">
    <div class="status-box">
        <div class="status-header">
            <div class="status-indicator" [ngClass]="getApiStatusClass()"></div>
            <strong translate>portal.apistatus</strong>
        </div>
        <div class="status-content">
            <span *ngIf="apiStatus">{{ apiStatus.status }}<br>
                <small *ngIf="apiStatus.timestamp">{{ apiStatus.timestamp }}</small>
                <span *ngIf="apiStatus.error" class="error-text">{{ apiStatus.error }}</span>
            </span>
            <span *ngIf="!apiStatus" class="loading-text" translate>common.loading</span>
        </div>
    </div>
    <div class="status-box">
        <div class="status-header">
            <div class="status-indicator" [ngClass]="getDbStatusClass()"></div>
            <strong translate>portal.dbstatus</strong>
        </div>
        <div class="status-content">
            <span *ngIf="dbStatus">{{ dbStatus.status }}<br>
                <small *ngIf="dbStatus.timestamp">{{ dbStatus.timestamp }}</small>
                <span *ngIf="dbStatus.error" class="error-text">{{ dbStatus.error }}</span>
            </span>
            <span *ngIf="!dbStatus" class="loading-text" translate>common.loading</span>
        </div>
    </div>
</div>

<div class="portal-login-section">
    <form *ngIf="!loginSuccess" (ngSubmit)="login()" #loginForm="ngForm" class="login-form">
        <input name="username" [(ngModel)]="username" type="text" [placeholder]="'portal.username' | translate"
            required>
        <input name="password" [(ngModel)]="password" type="password" [placeholder]="'portal.password' | translate"
            required>
        <button type="submit" translate>portal.login</button>
        <div *ngIf="loginError" class="error-message">{{ loginError }}</div>
    </form>
    <div *ngIf="loginSuccess" class="welcome-form">
        <span>{{ 'portal.welcome' | translate:{ username: userData?.user?.username } }}</span>
        <button type="button" (click)="logout()" translate>portal.logout</button>
    </div>
</div>

<!-- Fun message for non-logged users -->
<div *ngIf="!isLoggedIn" class="demo-notice">
    <div class="demo-header">
        <span class="demo-icon">ðŸŽ¯</span>
        <h3 translate>portal.demomode</h3>
    </div>
    <p translate>portal.demomessage</p>
</div>

<!-- Skills Management Section -->
<div class="management-section">
    <div class="section-header">
        <h2 translate>portal.skillsmanagement</h2>
        <button class="btn-create" (click)="openCreateSkill()" translate>portal.createskill</button>
    </div>

    <div *ngIf="skillsLoading" class="loading" translate>common.loadingskills</div>
    <div *ngIf="skillsError" class="error-message">{{ skillsError }}</div>

    <div *ngIf="!skillsLoading && !skillsError" class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th translate>common.id</th>
                    <th translate>common.name</th>
                    <th translate>common.order</th>
                    <th translate>common.image</th>
                    <th translate>portal.actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let skill of skills" class="data-row">
                    <td>{{ skill.id }}</td>
                    <td>{{ skill.name }}</td>
                    <td>{{ skill.order }}</td>
                    <td>
                        <img *ngIf="skill.filename" [src]="api.getImageUrl(skill.filename)" [alt]="skill.name"
                            class="preview-image">
                        <span *ngIf="!skill.filename" translate>common.noimage</span>
                    </td>
                    <td class="actions">
                        <button class="btn-edit" (click)="openEditSkill(skill)" translate>portal.edit</button>
                        <button class="btn-delete" (click)="openDeleteSkill(skill)" translate>portal.delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="skills.length === 0" class="no-data" translate>common.noskillsfound</div>
    </div>
</div>

<!-- Projects Management Section -->
<div class="management-section">
    <div class="section-header">
        <h2 translate>portal.projectsmanagement</h2>
        <button class="btn-create" (click)="openCreateProject()" translate>portal.createproject</button>
    </div>

    <div *ngIf="projectsLoading" class="loading" translate>common.loadingprojects</div>
    <div *ngIf="projectsError" class="error-message">{{ projectsError }}</div>

    <div *ngIf="!projectsLoading && !projectsError" class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th translate>common.id</th>
                    <th translate>common.order</th>
                    <th translate>common.title</th>
                    <th translate>common.description</th>
                    <th translate>common.image</th>
                    <th translate>portal.actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let project of projects" class="data-row">
                    <td>{{ project.id }}</td>
                    <td>{{ project.order }}</td>
                    <td>{{ project.title }}</td>
                    <td class="description-cell">{{ project.description }}</td>
                    <td>
                        <img *ngIf="project.image" [src]="api.getImageUrl(project.image)" [alt]="project.title"
                            class="preview-image">
                        <span *ngIf="!project.image" translate>common.noimage</span>
                    </td>
                    <td class="actions">
                        <button class="btn-edit" (click)="openEditProject(project)" translate>portal.edit</button>
                        <button class="btn-delete" (click)="openDeleteProject(project)" translate>portal.delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="projects.length === 0" class="no-data" translate>common.noprojectsfound</div>
    </div>
</div>

<!-- Skills Popups -->
<app-skill-create *ngIf="showSkillCreate" (close)="onSkillPopupClosed()" (skillCreated)="onSkillCreated()">
</app-skill-create>

<app-skill-edit *ngIf="showSkillEdit && selectedSkill" [skill]="selectedSkill" (close)="onSkillPopupClosed()"
    (skillUpdated)="onSkillUpdated()">
</app-skill-edit>

<app-skill-delete *ngIf="showSkillDelete && selectedSkill" [skill]="selectedSkill" (close)="onSkillPopupClosed()"
    (skillDeleted)="onSkillDeleted()">
</app-skill-delete>

<!-- Projects Popups -->
<app-project-create *ngIf="showProjectCreate" (close)="onProjectPopupClosed()" (projectCreated)="onProjectCreated()">
</app-project-create>

<app-project-edit *ngIf="showProjectEdit && selectedProject" [project]="selectedProject"
    (close)="onProjectPopupClosed()" (projectUpdated)="onProjectUpdated()">
</app-project-edit>

<app-project-delete *ngIf="showProjectDelete && selectedProject" [project]="selectedProject"
    (close)="onProjectPopupClosed()" (projectDeleted)="onProjectDeleted()">
</app-project-delete>