<div class="portal-status-container">
    <div class="status-box">
        <strong>API Status</strong><br>
        <span *ngIf="apiStatus">{{ apiStatus.status }}<br>
            <small *ngIf="apiStatus.timestamp">{{ apiStatus.timestamp }}</small>
            <span *ngIf="apiStatus.error" style="color:red;">{{ apiStatus.error }}</span>
        </span>
        <span *ngIf="!apiStatus">Loading...</span>
    </div>
    <div class="status-box">
        <strong>DB Status</strong><br>
        <span *ngIf="dbStatus">{{ dbStatus.status }}<br>
            <small *ngIf="dbStatus.timestamp">{{ dbStatus.timestamp }}</small>
            <span *ngIf="dbStatus.error" style="color:red;">{{ dbStatus.error }}</span>
        </span>
        <span *ngIf="!dbStatus">Loading...</span>
    </div>
</div>

<div class="portal-login-section">
    <form *ngIf="!loginSuccess" (ngSubmit)="login()" #loginForm="ngForm" class="login-form">
        <input name="username" [(ngModel)]="username" type="text" placeholder="Username" required>
        <input name="password" [(ngModel)]="password" type="password" placeholder="Password" required>
        <button type="submit">Login</button>
        <div *ngIf="loginError" class="error-message">{{ loginError }}</div>
    </form>
    <div *ngIf="loginSuccess" class="welcome-form">
        <span>Welcome, {{ userData?.user?.username }}</span>
        <button type="button" (click)="logout()">Logout</button>
    </div>
</div>

<div class="skills-section">
    <div class="skills-header">
        <h2>Skills Management</h2>
        <button *ngIf="isLoggedIn" class="btn-create" (click)="openCreateSkill()">Create Skill</button>
    </div>

    <div *ngIf="skillsLoading" class="loading">Loading skills...</div>
    <div *ngIf="skillsError" class="error-message">{{ skillsError }}</div>

    <div *ngIf="!skillsLoading && !skillsError" class="skills-table-container">
        <table class="skills-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Order</th>
                    <th>Image</th>
                    <th *ngIf="isLoggedIn">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let skill of skills" class="skill-row">
                    <td>{{ skill.id }}</td>
                    <td>{{ skill.name }}</td>
                    <td>{{ skill.order }}</td>
                    <td>
                        <img *ngIf="skill.filename" [src]="api.getImageUrl(skill.filename)" [alt]="skill.name"
                            class="skill-image">
                        <span *ngIf="!skill.filename">No image</span>
                    </td>
                    <td *ngIf="isLoggedIn" class="actions">
                        <button class="btn-edit" (click)="openEditSkill(skill)">Edit</button>
                        <button class="btn-delete" (click)="openDeleteSkill(skill)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="skills.length === 0" class="no-skills">
            No skills found.
        </div>
    </div>
</div>

<!-- Popups -->
<app-skill-create *ngIf="showSkillCreate" (close)="onPopupClosed()" (skillCreated)="onSkillCreated()">
</app-skill-create>

<app-skill-edit *ngIf="showSkillEdit && selectedSkill" [skill]="selectedSkill" (close)="onPopupClosed()"
    (skillUpdated)="onSkillUpdated()">
</app-skill-edit>

<app-skill-delete *ngIf="showSkillDelete && selectedSkill" [skill]="selectedSkill" (close)="onPopupClosed()"
    (skillDeleted)="onSkillDeleted()">
</app-skill-delete>